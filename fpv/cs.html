<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>初赛成绩｜Flyz远征飞</title>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

:root {
--tech-blue: #0096FF;
--tech-dark: #0066CC;
--tech-light: #66CCFF;
--tech-gray: #F0F7FF;
--gold: #FFD700;
--red: #FF4444;
--text-main: #333333;
--text-light: #FFFFFF;
--shadow: 0 4px 20px rgba(0, 150, 255, 0.15);
--radius: 12px;
}

body {
font-family: system-ui, -apple-system, sans-serif;
background-color: #000814;
background-image:
linear-gradient(rgba(0, 150, 255, 0.1) 1px, transparent 1px),
linear-gradient(90deg, rgba(0, 150, 255, 0.1) 1px, transparent 1px);
background-size: 30px 30px;
color: var(--text-main);
min-height: 100vh;
padding: 20px 0;
position: relative;
overflow-x: hidden;
}

.page-container {
max-width: 1400px;
margin: 0 auto;
padding: 0 20px;
}

.header-logo {
display: flex;
align-items: center;
margin-bottom: 20px;
position: relative;
z-index: 10;
}

.logo-img {
width: 60px;
height: 60px;
border-radius: 10px;
box-shadow: 0 0 20px var(--tech-light);
transition: all 0.3s ease;
}

.logo-img:hover {
transform: rotate(5deg) scale(1.1);
box-shadow: 0 0 30px var(--tech-blue);
}

.logo-text-group {
margin-left: 15px;
}

.logo-domain {
font-size: 1.5rem;
color: var(--tech-blue);
font-weight: bold;
text-shadow: 0 0 15px var(--tech-light);
letter-spacing: 1px;
background: linear-gradient(90deg, var(--tech-light), var(--tech-blue));
-webkit-background-clip: text;
background-clip: text;
color: transparent;
animation: logoGlow 3s ease-in-out infinite;
}

@keyframes logoGlow {
0%, 100% { background-position: 0% 50%; }
50% { background-position: 100% 50%; }
}

.logo-slogan {
font-size: 1rem;
color: var(--tech-light);
text-shadow: 0 0 10px rgba(0, 150, 255, 0.3);
animation: sloganBreath 4s ease-in-out infinite;
}

@keyframes sloganBreath {
0%, 100% { opacity: 0.8; }
50% { opacity: 1; }
}

.page-title {
text-align: center;
font-size: 3rem;
color: var(--text-light);
margin: 10px 0 20px;
text-shadow: 0 0 25px var(--tech-light);
letter-spacing: 3px;
position: relative;
}

.page-title::after {
content: '';
display: block;
width: 120px;
height: 4px;
background: linear-gradient(90deg, transparent, var(--tech-blue), transparent);
margin: 15px auto 0;
border-radius: 2px;
}

.refresh-time {
text-align: center;
font-size: 1.1rem;
color: var(--tech-light);
margin-bottom: 20px;
text-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
}

.refresh-time span {
color: var(--gold);
font-weight: bold;
}

.tab-content {
background-color: rgba(255, 255, 255, 0.95);
border-radius: var(--radius);
padding: 30px;
box-shadow: var(--shadow);
margin-bottom: 30px;
border: 1px solid rgba(0, 150, 255, 0.3);
position: relative;
overflow: hidden;
}

.tab-content::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(90deg, var(--tech-blue), var(--tech-light));
}

.section-title {
font-size: 2rem;
color: var(--tech-dark);
margin-bottom: 20px;
text-align: center;
font-weight: 600;
}

.section-title::after {
content: '';
display: block;
width: 60px;
height: 3px;
background-color: var(--tech-blue);
margin: 12px auto 0;
border-radius: 3px;
}

.data-table {
width: 100%;
border-collapse: separate;
border-spacing: 0;
border-radius: var(--radius);
overflow: hidden;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.data-table th {
background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
color: var(--text-light);
padding: 14px 10px;
font-size: 1.05rem;
text-align: center;
letter-spacing: 1px;
position: relative;
}

.data-table th::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
width: 100%;
height: 2px;
background: linear-gradient(90deg, transparent, var(--tech-light), transparent);
animation: headerShine 2s ease-in-out infinite;
}

@keyframes headerShine {
0%, 100% { opacity: 0.5; }
50% { opacity: 1; }
}

.data-table td {
padding: 14px 10px;
text-align: center;
font-size: 0.95rem;
border-bottom: 1px solid rgba(0, 150, 255, 0.1);
transition: all 0.3s ease;
}

.data-table tr:last-child td {
border-bottom: none;
}

.data-table tr:hover {
background-color: var(--tech-gray);
transform: scale(1.005);
box-shadow: 0 3px 10px rgba(0, 150, 255, 0.1);
}

.rank-1 {
background: linear-gradient(120deg, #FFF8DC, #FFD700);
}

.rank-2 {
background: linear-gradient(120deg, #e6f7ff, #b3d9ff);
}

.rank-3 {
background: linear-gradient(120deg, #f3e6ff, #d9b3ff);
}

.btn-group {
display: flex;
justify-content: center;
gap: 20px;
margin-top: 30px;
}

.btn {
padding: 12px 30px;
border-radius: 50px;
border: none;
font-size: 1.1rem;
cursor: pointer;
transition: all 0.3s ease;
}

.export-btn {
background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
color: white;
box-shadow: 0 3px 10px rgba(0, 150, 255, 0.3);
}

.export-btn:hover {
transform: translateY(-3px);
box-shadow: 0 6px 15px rgba(0, 150, 255, 0.4);
}

.modal {
position: fixed;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
background-color: rgba(0, 8, 20, 0.85);
backdrop-filter: blur(10px);
z-index: 1000;
display: none;
align-items: center;
justify-content: center;
padding: 20px;
}

.modal.show {
display: flex;
animation: modalFade 0.4s ease-out;
}

@keyframes modalFade {
from { opacity: 0; }
to { opacity: 1; }
}

.modal-content {
background-color: rgba(255, 255, 255, 0.98);
border-radius: var(--radius);
padding: 30px;
width: 100%;
max-width: 800px;
max-height: 80vh;
overflow-y: auto;
box-shadow: 0 10px 40px rgba(0, 150, 255, 0.25);
border: 1px solid rgba(0, 150, 255, 0.3);
position: relative;
}

.modal-content::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 3px;
background: linear-gradient(90deg, var(--tech-blue), var(--tech-light));
}

.modal-title {
font-size: 1.9rem;
color: var(--tech-dark);
margin-bottom: 25px;
text-align: center;
}

.notice-content {
font-size: 1.1rem;
line-height: 1.8;
color: #333;
white-space: pre-wrap;
word-wrap: break-word;
word-break: normal;
}

.notice-btn-group {
display: flex;
justify-content: center;
margin-top: 30px;
}

.close-notice {
padding: 12px 30px;
border-radius: 50px;
border: none;
font-size: 1.1rem;
cursor: pointer;
background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
color: white;
box-shadow: 0 3px 10px rgba(0, 150, 255, 0.3);
}

footer {
width: 100%;
padding: 20px 0;
text-align: center;
font-size: 1rem;
color: #66CCFF;
text-shadow: 0 0 15px rgba(0, 150, 255, 0.6);
margin-top: 40px;
border-top: 1px solid rgba(0, 150, 255, 0.3);
background: rgba(0, 8, 20, 0.7);
backdrop-filter: blur(12px);
}

.footer-main {
font-size: 1.15rem;
font-weight: bold;
margin-bottom: 5px;
}

.footer-sub {
font-size: 0.9rem;
opacity: 0.92;
}

.feedback-btn {
position: fixed;
top: 20px;
right: 20px;
width: 60px;
height: 60px;
border-radius: 50%;
background: linear-gradient(135deg, var(--tech-blue), var(--tech-dark));
color: white;
display: flex;
align-items: center;
justify-content: center;
font-size: 24px;
box-shadow: 0 5px 20px rgba(0, 150, 255, 0.4);
cursor: pointer;
z-index: 999;
transition: all 0.3s ease;
}

.feedback-btn:hover {
transform: rotate(15deg) scale(1.1);
box-shadow: 0 8px 25px rgba(0, 150, 255, 0.5);
}

.feedback-modal .modal-content {
max-width: 600px;
}

.more-info-btn {
display: block;
width: fit-content;
margin: 20px auto 0;
padding: 10px 25px;
background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
color: white;
border-radius: 50px;
text-decoration: none;
font-size: 1.1rem;
box-shadow: 0 3px 10px rgba(0, 150, 255, 0.3);
transition: all 0.3s ease;
}

.more-info-btn:hover {
transform: translateY(-3px);
box-shadow: 0 6px 15px rgba(0, 150, 255, 0.4);
}

@media (max-width: 768px) {
.logo-img {
width: 50px;
height: 50px;
}

.logo-domain {
font-size: 1.2rem;
}

.logo-slogan {
font-size: 0.9rem;
}

.page-title {
font-size: 2.2rem;
}

.modal-content {
max-width: 95%;
padding: 20px;
}

.data-table th, .data-table td {
padding: 10px 5px;
font-size: 0.85rem;
}

.btn {
padding: 10px 20px;
font-size: 1rem;
}

.feedback-btn {
width: 50px;
height: 50px;
font-size: 20px;
}
}
</style>
</head>

<body>
<div class="page-container">
<div class="header-logo">
<img src="https://i.ooxx.ooo/i/N2ZlN.jpg" alt="Flyz远征飞 Logo" class="logo-img">
<div class="logo-text-group">
<div class="logo-domain">917813.com.cn</div>
<div class="logo-slogan">Flyz远征飞｜为方便模友而生</div>
</div>
</div>

<h1 class="page-title">Flyz远征飞2026全国线上FPV赛事</h1>

<div class="refresh-time">
成绩最后刷新时间：<span id="last-update">加载中...</span>
<br>
<span style="font-size:0.95rem;">每 20 秒自动刷新，人工核实成绩可能有延迟</span>
</div>

<div class="tab-content">
<h2 class="section-title">初赛成绩实时排名</h2>

<table class="data-table">
<thead>
<tr>
<th width="8%">排名</th>
<th width="12%">比赛ID</th>
<th width="18%">Steam ID</th>
<th width="15%">初赛成绩</th>
<th width="15%">复赛成绩</th>
<th width="15%">决赛成绩</th>
<th width="15%">微信ID</th>
<th width="12%">报名状态</th>
</tr>
</thead>
<tbody id="cs-rank-list">
<tr>
<td colspan="8" style="color:var(--tech-blue); padding:40px;">正在加载成绩数据...</td>
</tr>
</tbody>
</table>

<div class="btn-group">
<button class="btn export-btn" onclick="exportToImage()">导出成绩为图片</button>
</div>
</div>
</div>

<footer>
<div class="footer-main">
天津魄客创新（科技）有限公司 · PokRC 团队
</div>
<div class="footer-sub">
微型 250g 无人机极速世界纪录保持者 · 全力支持本次赛事
</div>
</footer>

<div class="modal" id="notice-modal">
<div class="modal-content">
<h3 class="modal-title">Flyz远征飞2026全国线上FPV赛事公告</h3>
<div class="notice-content" id="notice-content"></div>
<div class="notice-btn-group">
<button class="close-notice" onclick="closeModal('notice-modal')">关闭</button>
</div>
</div>
</div>

<div class="modal feedback-modal" id="feedback-modal">
<div class="modal-content">
<h3 class="modal-title">反馈与帮助</h3>
<div class="notice-content" style="text-align:center; font-size:1.2rem; line-height:2;">
反馈成绩问题、信息不全或报名问题<br><br>
请加微信号：<strong style="color:var(--tech-blue);">YGWFK2024</strong><br><br>
或在交流群内反馈<br>
加微信拉你进赛事交流群<br><br>
<a href="/index" class="more-info-btn">点我了解更多赛事信息</a>
</div>
<div class="notice-btn-group">
<button class="close-notice" onclick="closeModal('feedback-modal')">关闭</button>
</div>
</div>
</div>

<div id="export-container" style="position:fixed; top:-9999px; left:-9999px; background:#fff; width:1200px; padding:40px; border-radius:12px;"></div>

<div class="feedback-btn" onclick="openModal('feedback-modal')">
❗
</div>

<script>
$(document).ready(function() {
$.get('/fpv/gonggao.txt', function(data) {
$('#notice-content').text(data);
$('#notice-modal').addClass('show');
}).fail(function() {
$('#notice-content').html('<p style="color:var(--tech-blue); text-align:center;">公告文件加载失败</p>');
$('#notice-modal').addClass('show');
});

loadCSRank();
setInterval(loadCSRank, 20000);
});

function openModal(modalId) {
document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
document.getElementById(modalId).classList.remove('show');
}

function loadCSRank() {
$.get('/fpv/cs.txt', function(data) {
const lines = data.split('\n').map(line => line.trim()).filter(line => line);
const rankList = [];

lines.forEach(line => {
const parts = line.split('=');
if (parts.length < 7) return;

const pid = parts[0];
const steam = parts[1];
const cs = parts[2] || '无成绩';
const fs = parts[3] || '无成绩';
const js = parts[4] || '无成绩';
const wechat = parts[5] || '未填写';
const status = parts[6] || '未报名';

rankList.push({
pid: pid,
steam: steam,
cs: cs,
fs: fs,
js: js,
wechat: wechat,
status: status,
timeMs: scoreToMs(cs)
});
});

rankList.sort((a, b) => {
if (a.timeMs === null) return 1;
if (b.timeMs === null) return -1;
return a.timeMs - b.timeMs;
});

const tbody = $('#cs-rank-list');
tbody.empty();

rankList.forEach((item, index) => {
let rankClass = '';
if (index === 0) rankClass = 'rank-1';
if (index === 1) rankClass = 'rank-2';
if (index === 2) rankClass = 'rank-3';

tbody.append(`
<tr class="${rankClass}">
<td>${index + 1}</td>
<td>${item.pid}</td>
<td>${item.steam}</td>
<td>${item.cs}</td>
<td>${item.fs}</td>
<td>${item.js}</td>
<td>${item.wechat}</td>
<td>${item.status}</td>
</tr>
`);
});

$('#last-update').text(new Date().toLocaleString());
}).fail(function() {
$('#cs-rank-list').html(`
<tr>
<td colspan="8" style="color:var(--tech-blue); padding:40px;">
成绩数据加载失败，请检查 /fpv/cs.txt 文件
</td>
</tr>
`);
});
}

function scoreToMs(score) {
if (!score || score === '无成绩') return null;

const parts = score.split(':');
if (parts.length !== 3) return null;

const min = parseInt(parts[0]) || 0;
const sec = parseInt(parts[1]) || 0;
const ms = parseInt(parts[2]) || 0;

return min * 60000 + sec * 1000 + ms;
}

function exportToImage() {
const container = $('#export-container');
const table = $('.data-table')[0].outerHTML;

container.html(`
<div style="text-align:center; margin-bottom:20px;">
<h2 style="color:#0066CC; font-size:1.8rem;">Flyz远征飞2026全国线上FPV赛事 · 初赛成绩</h2>
<p style="color:#666; margin-top:10px;">导出时间：${new Date().toLocaleString()}</p>
</div>
${table}
`);

html2canvas(container[0], { scale: 2, useCORS: true }).then(canvas => {
const link = document.createElement('a');
link.href = canvas.toDataURL('image/png', 1.0);
link.download = `Flyz初赛成绩_${new Date().getTime()}.png`;
link.click();
alert('成绩图片已成功导出！');
});
}
</script>

</body>
</html>
