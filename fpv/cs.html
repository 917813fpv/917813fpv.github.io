<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>初赛成绩｜Flyz远征飞</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <style>
    /* 全局样式重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --tech-blue: #0096FF;
      --tech-dark: #0066CC;
      --tech-light: #66CCFF;
      --tech-gray: #F0F7FF;
      --gold: #FFD700;
      --red: #FF4444;
      --text-main: #333333;
      --text-light: #FFFFFF;
      --shadow: 0 4px 20px rgba(0, 150, 255, 0.15);
      --radius: 12px;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background-color: #000814;
      background-image: 
        linear-gradient(rgba(0, 150, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 150, 255, 0.1) 1px, transparent 1px);
      background-size: 30px 30px;
      color: var(--text-main);
      min-height: 100vh;
      padding: 20px 0;
      position: relative;
      overflow-x: hidden;
    }

    .page-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .header-logo {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      position: relative;
      z-index: 10;
    }

    .logo-img {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      box-shadow: 0 0 20px var(--tech-light);
      transition: all 0.3s ease;
    }

    .logo-img:hover {
      transform: rotate(5deg) scale(1.1);
      box-shadow: 0 0 30px var(--tech-blue);
    }

    .logo-text-group {
      margin-left: 15px;
    }

    .logo-domain {
      font-size: 1.5rem;
      color: var(--tech-blue);
      font-weight: bold;
      text-shadow: 0 0 15px var(--tech-light);
      letter-spacing: 1px;
      background: linear-gradient(90deg, var(--tech-light), var(--tech-blue));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: logoGlow 3s ease-in-out infinite;
    }

    @keyframes logoGlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .logo-slogan {
      font-size: 1rem;
      color: var(--tech-light);
      text-shadow: 0 0 10px rgba(0, 150, 255, 0.3);
      animation: sloganBreath 4s ease-in-out infinite;
    }

    @keyframes sloganBreath {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .page-title {
      text-align: center;
      font-size: 3rem;
      color: var(--text-light);
      margin: 10px 0 40px;
      text-shadow: 0 0 25px var(--tech-light);
      letter-spacing: 3px;
      position: relative;
    }

    .page-title::after {
      content: '';
      display: block;
      width: 120px;
      height: 4px;
      background: linear-gradient(90deg, transparent, var(--tech-blue), transparent);
      margin: 15px auto 0;
      border-radius: 2px;
    }

    .tab-content {
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius);
      padding: 40px;
      box-shadow: var(--shadow);
      margin-bottom: 40px;
      border: 1px solid rgba(0, 150, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .tab-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--tech-blue), var(--tech-light));
    }

    .section-title {
      font-size: 2rem;
      color: var(--tech-dark);
      margin-bottom: 30px;
      text-align: center;
      font-weight: 600;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 60px;
      height: 3px;
      background-color: var(--tech-blue);
      margin: 12px auto 0;
      border-radius: 3px;
    }

    /* 表格样式 */
    .data-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .data-table th {
      background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
      color: var(--text-light);
      padding: 18px;
      font-size: 1.15rem;
      text-align: center;
      letter-spacing: 1px;
      position: relative;
    }

    .data-table th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--tech-light), transparent);
      animation: headerShine 2s ease-in-out infinite;
    }

    @keyframes headerShine {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .data-table td {
      padding: 18px;
      text-align: center;
      font-size: 1.05rem;
      border-bottom: 1px solid rgba(0, 150, 255, 0.1);
      transition: all 0.3s ease;
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover {
      background-color: var(--tech-gray);
      transform: scale(1.01);
      box-shadow: 0 3px 10px rgba(0, 150, 255, 0.1);
    }

    /* 前三名特殊样式 */
    .rank-1 {
      background: linear-gradient(120deg, #FFF8DC, #FFD700);
    }

    .rank-2 {
      background: linear-gradient(120deg, #e6f7ff, #b3d9ff);
    }

    .rank-3 {
      background: linear-gradient(120deg, #f3e6ff, #d9b3ff);
    }

    /* 刷新时间提示 */
    .refresh-time {
      text-align: center;
      font-size: 1.1rem;
      color: var(--tech-blue);
      margin-bottom: 20px;
      font-weight: 500;
    }

    .refresh-time span {
      color: var(--red);
      font-weight: bold;
    }

    /* 公告弹窗 */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 8, 20, 0.85);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
      animation: modalFade 0.4s ease-out;
    }

    @keyframes modalFade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background-color: rgba(255, 255, 255, 0.98);
      border-radius: var(--radius);
      padding: 40px;
      width: 100%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 150, 255, 0.25);
      border: 1px solid rgba(0, 150, 255, 0.3);
      position: relative;
    }

    .modal-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--tech-blue), var(--tech-light));
    }

    .modal-title {
      font-size: 1.9rem;
      color: var(--tech-dark);
      margin-bottom: 25px;
      text-align: center;
    }

    .notice-content {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
      word-break: normal;
    }

    .notice-btn-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .notice-btn {
      padding: 12px 30px;
      border-radius: 50px;
      border: none;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-notice {
      background: linear-gradient(90deg, var(--tech-dark), var(--tech-blue));
      color: white;
      box-shadow: 0 3px 10px rgba(0, 150, 255, 0.3);
    }

    /* 页脚 */
    footer {
      width: 100%;
      padding: 26px 0;
      text-align: center;
      font-size: 1.1rem;
      color: #66CCFF;
      text-shadow: 0 0 15px rgba(0, 150, 255, 0.6);
      margin-top: 60px;
      border-top: 1px solid rgba(0, 150, 255, 0.3);
      background: rgba(0, 8, 20, 0.7);
      backdrop-filter: blur(12px);
      position: relative;
      z-index: 5;
    }

    .footer-main {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .footer-sub {
      font-size: 0.95rem;
      opacity: 0.92;
    }

    /* 适配手机 */
    @media (max-width: 768px) {
      .logo-img {
        width: 50px;
        height: 50px;
      }

      .logo-domain {
        font-size: 1.2rem;
      }

      .logo-slogan {
        font-size: 0.9rem;
      }

      .page-title {
        font-size: 2.2rem;
      }

      .modal-content {
        max-width: 95%;
        padding: 20px;
      }

      .data-table th {
        padding: 12px;
        font-size: 0.9rem;
      }

      .data-table td {
        padding: 12px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>
  <div class="page-container">
    <div class="header-logo">
      <img src="https://img520.com/UIGuUV.jpeg" alt="Flyz远征飞 Logo" class="logo-img">
      <div class="logo-text-group">
        <div class="logo-domain">917813.com.cn</div>
        <div class="logo-slogan">Flyz远征飞｜为方便模友而生</div>
      </div>
    </div>

    <h1 class="page-title">Flyz远征飞2026全国线上FPV赛事</h1>

    <div class="tab-content">
      <h2 class="section-title">初赛成绩实时排名</h2>

      <div class="refresh-time">
        当前成绩最后刷新时间：<span id="last-update">加载中...</span>
        <br>
        <span style="color:#666; font-size:0.95rem;">成绩每 20 秒自动刷新一次，人工核实可能有延迟</span>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th width="10%">排名</th>
            <th width="30%">选手ID</th>
            <th width="35%">选手姓名</th>
            <th width="25%">初赛成绩</th>
          </tr>
        </thead>
        <tbody id="cs-rank-list">
          <tr>
            <td colspan="4" style="color:var(--tech-blue); padding:40px;">正在加载成绩数据...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <footer>
    <div class="footer-main">
      天津魄客创新（科技）有限公司 · PokRC 团队
    </div>
    <div class="footer-sub">
      微型 250g 无人机极速世界纪录保持者 · 全力支持本次赛事
    </div>
  </footer>

  <!-- 公告弹窗 -->
  <div class="modal" id="notice-modal">
    <div class="modal-content">
      <h3 class="modal-title">Flyz远征飞2026全国线上FPV赛事公告</h3>
      <div class="notice-content" id="notice-content"></div>
      <div class="notice-btn-group">
        <button class="notice-btn close-notice" onclick="closeModal('notice-modal')">关闭</button>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      // 加载公告
      $.get('/fpv/gonggao.txt', function(data) {
        $('#notice-content').text(data);
        $('#notice-modal').addClass('show');
      }).fail(function() {
        $('#notice-content').html('<p style="color:var(--tech-blue); text-align:center;">公告文件加载失败，请检查 /fpv/gonggao.txt 路径</p>');
        $('#notice-modal').addClass('show');
      });

      // 加载成绩并排序
      loadCSRank();

      // 每 20 秒刷新一次
      setInterval(loadCSRank, 20000);
    });

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }

    // 加载初赛成绩并自动排序
    function loadCSRank() {
      $.when(
        $.get('/fpv/flyer.txt'),
        $.get('/fpv/cs.txt')
      ).done(function(flyerData, csData) {
        const players = flyerData[0].split('\n').map(n => n.trim()).filter(n => n);
        const scores = csData[0].split('\n').map(s => s.trim()).filter(s => s);

        // 组合数据
        let rankList = [];
        players.forEach((name, index) => {
          const score = scores[index] || '无成绩';
          rankList.push({
            id: 'PID' + (index + 1).toString().padStart(3, '0'),
            name: name,
            score: score,
            timeMs: scoreToMs(score)
          });
        });

        // 按成绩排序（时间越短越靠前）
        rankList.sort((a, b) => {
          if (a.timeMs === null) return 1;
          if (b.timeMs === null) return -1;
          return a.timeMs - b.timeMs;
        });

        // 渲染表格
        const tbody = $('#cs-rank-list');
        tbody.empty();

        rankList.forEach((item, index) => {
          let rankClass = '';
          if (index === 0) rankClass = 'rank-1';
          if (index === 1) rankClass = 'rank-2';
          if (index === 2) rankClass = 'rank-3';

          tbody.append(`
            <tr class="${rankClass}">
              <td>${index + 1}</td>
              <td>${item.id}</td>
              <td>${item.name}</td>
              <td>${item.score}</td>
            </tr>
          `);
        });

        // 更新刷新时间
        $('#last-update').text(new Date().toLocaleString());
      }).fail(function() {
        $('#cs-rank-list').html(`
          <tr>
            <td colspan="4" style="color:var(--tech-blue); padding:40px;">
              成绩数据加载失败，请检查 /fpv/flyer.txt 和 /fpv/cs.txt 文件路径
            </td>
          </tr>
        `);
      });
    }

    // 将 "0:27:415" 转换为毫秒，用于排序
    function scoreToMs(score) {
      if (!score || score === '无成绩') return null;

      const parts = score.split(':');
      if (parts.length !== 3) return null;

      const min = parseInt(parts[0]) || 0;
      const sec = parseInt(parts[1]) || 0;
      const ms = parseInt(parts[2]) || 0;

      return min * 60000 + sec * 1000 + ms;
    }
  </script>
</body>
</html>
